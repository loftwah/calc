---
import { operooConfig } from '../configs/operoo';
import Slider from './Slider.astro';
import Result from './Result.astro';
---

<div class="max-w-3xl mx-auto bg-white rounded-lg shadow-sm p-8">
  <div class="space-y-6">
    {operooConfig.elements.map((element) => (
      element.type === 'slider' ? (
        <Slider
          id={element.id}
          label={element.label}
          min={element.min}
          max={element.max}
          step={element.step}
          default={element.default}
          description={element.description}
        />
      ) : null
    ))}
  </div>

  <div class="mt-8 space-y-2">
    <Result id="paperCost" label="Paper Costs @ 1.4c per page" value={0} />
    <Result id="printingCost" label="Priting/Toner Costs @ 1.2c per page" value={0} />
    <Result id="maintenanceCost" label="Printer/Copier Maintenance @ $395 service fee every 50,000 copies" value={0} />
    <Result id="postageCost" label="Postage Costs @ 50c per mailout" value={0} />
    <Result id="totalCost" label="Total" value={0} isTotal={true} />
  </div>
</div>

<script>
  function calculateResults(values) {
    const paperCost = values.students * values.pagesStudent * 0.014;
    const printingCost = (values.students * values.pagesStudent + values.staff * values.pagesStaff) * 0.012;
    const maintenanceCost = ((values.students * values.pagesStudent + values.staff * values.pagesStaff) / 50000) * 395;
    const postageCost = values.students * values.mailoutsStudent * 0.5;
    const totalCost = paperCost + printingCost + maintenanceCost + postageCost;

    return { paperCost, printingCost, maintenanceCost, postageCost, totalCost };
  }

  // Initialize values object with defaults
  const values = {};
  document.querySelectorAll('input[type="range"]').forEach(slider => {
    values[slider.id] = Number(slider.value);
  });

  // Update results when sliders change
  document.addEventListener('calculator-update', (event) => {
    values[event.detail.id] = event.detail.value;
    const results = calculateResults(values);
    
    Object.entries(results).forEach(([key, value]) => {
      const element = document.getElementById(`${key}-result`);
      if (element) {
        element.textContent = `${value.toLocaleString('en-US', { 
          minimumFractionDigits: 2, 
          maximumFractionDigits: 2 
        })} USD`;
      }
    });
  });

  // Calculate initial results
  const initialResults = calculateResults(values);
  Object.entries(initialResults).forEach(([key, value]) => {
    const element = document.getElementById(`${key}-result`);
    if (element) {
      element.textContent = `${value.toLocaleString('en-US', { 
        minimumFractionDigits: 2, 
        maximumFractionDigits: 2 
      })} USD`;
    }
  });
</script> 